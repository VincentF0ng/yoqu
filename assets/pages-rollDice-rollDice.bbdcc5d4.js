import{p as e,K as s,c as t,Q as i,R as a,v as o,s as h,T as l,o as n,a as d,w as r,q as c,g as p,d as u,u as m,x as f,F as v,O as g,f as b,t as w,b as Y,i as C,r as X,U as _,V as x,W as y,e as M,n as k}from"./index-ab7ec73d.js";import{_ as I}from"./uni-icons.63e5f710.js";import{r as T}from"./uni-app.es.f46513ae.js";import{_ as U}from"./uni-data-checkbox.3fa5ad8a.js";import{_ as S,a as D}from"./uni-forms.558fa597.js";import{_ as z}from"./uni-popup.1c804f7e.js";import{_ as j}from"./_plugin-vue_export-helper.1b428a4d.js";import"./uni-load-more.73ff6927.js";import"./uni-transition.d68f7a54.js";const V=j({data:()=>({bannerAdpid:"",bannerUnitId:"",perFace:[[-.1,.3,-1],[-.1,.6,-.4],[-.85,-.42,.73],[-.8,.3,-.75],[.3,.45,.9],[-.16,.6,.18]],vals:[1],posX:[0],posY:[0],speed:[10],moveX:[!0],moveY:[!0],clienWidth:0,clientHeight:0,diceSize:0,marginTop:50,isthrow:!1,isrolling:!1,showRes:!1,colors:[{text:"白色",value:""},{text:"红色",value:"red"},{text:"黄色",value:"yellow"},{text:"绿色",value:"green"},{text:"蓝色",value:"blue"},{text:"紫色",value:"purple"}],diceColor:"",isMute:!1,audioContext:null}),methods:{init(){const a=e("dice_num")||5,o=e("dice_color")||"",h=e("dice_mute")||!1;this.diceColor=o,this.isMute=h,this.clientWidth=s().windowWidth,this.clientHeight=s().windowHeight;t().in(this).select(".dice-wrap").boundingClientRect((e=>{this.diceSize=e.width,this.posX[0]=this.clientWidth/2-e.width/2,this.posY[0]=e.width;for(let s=0;s<a-1;s++)this.addDice()})).exec(),i(this.handleShake)},destroy(){a(),this.timer&&clearInterval(this.timer)},setting(){o(),this.$refs.popup.open("top")},diceNumChange(e){const s=e.detail.value,t=this.vals.length;if(s!==t){if(s>t){for(let e=0;e<s-t;e++)this.addDice();this.randomDiceThrow()}else this.vals=this.vals.slice(0,s),this.posX=this.posX.slice(0,s),this.posY=this.posY.slice(0,s),this.speed=this.speed.slice(0,s),this.moveX=this.moveX.slice(0,s),this.moveY=this.moveY.slice(0,s);h("dice_num",s)}},diceColorChange(e){const s=e.detail.value;h("dice_color",s)},diceMuteChange(e){this.isMute=e.detail.value},addDice(){this.vals.push(Math.floor(5*Math.random())+1),this.posX.push(Math.floor(Math.random()*(this.clientWidth-this.diceSize))),this.posY.push(Math.floor(Math.random()*(this.clientHeight-this.diceSize-this.marginTop))+this.marginTop),this.speed.push(10+Math.floor(5*Math.random())),this.moveX.push(!0),this.moveY.push(!0)},handleShake(e){(e.x>1||e.y>1||e.z>1)&&this.randomDiceThrow()},randomDiceThrow(){if(this.timer)return;const e=this.vals.length,s=[];for(let t=0;t<e;t++)s.push(Math.floor(6*Math.random())+1);this.vals=s,this.isthrow=!0,this.showRes=!1,setTimeout((e=>{this.isthrow=!1,this.showRes=!0,this.timer&&clearInterval(this.timer),this.timer=null,this.runToCenter()}),1400),this.timer=setInterval((()=>{for(var e=0;e<this.vals.length;e++)this.run(e,this.speed[e])}),15)},runToCenter(){const e=l(),s=e.windowWidth,t=e.windowHeight,i=this.vals.length,a=s/2-this.diceSize/2,o=t/2-this.diceSize/2,h=this.diceSize*(.5+i/10),n=Math.PI/180*Math.round(360/i),d=[];for(var r=0;r<i;r++)d.push({x:a+h*Math.sin(n*r),y:o+h*Math.cos(n*r)});setTimeout((e=>{this.timer&&clearInterval(this.timer),this.timer=null}),1e3),this.timer=setInterval((e=>{for(let s=0;s<i;s++)this.moveDiceTo(s,d[s])}),15)},moveDiceTo(e,s){const t=this.speed[e],i=this.posX[e],a=this.posY[e],o=s.x,h=s.y;i<o-t?this.posX[e]+=t:i>o+t?this.posX[e]-=t:this.posX[e]=o,a<h-t?this.posY[e]+=t:a>h+t?this.posY[e]-=t:this.posY[e]=h},crash(e){const s=this.diceSize,t=this.posX[e]+s/2,i=this.posY[e]+s/2,a=this.posX[e]-s,o=this.posX[e]+2*s,h=this.posY[e]-s,l=this.posY[e]+2*s;for(let p=0;p<this.vals.length;p++)if(p!=e){var n=this.posX[p]+s/2,d=this.posY[p]+s/2;if(n>=a&&n<=o&&d>=h&&d<=l){var r=t-n,c=i-d;r*r+c*c<=s*s&&(n>t?d>i?(this.moveX[e]=!0,this.moveY[e]=!0):d<i?(this.moveX[e]=!0,this.moveY[e]=!1):this.moveX[e]=!0:n<t?d>i?(this.moveX[e]=!1,this.moveY[e]=!0):d<i?(this.moveX[e]=!1,this.moveY[e]=!1):this.moveX[e]=!1:(n=t)&&(d>i?this.moveY[e]=!0:d<i&&(this.moveY[e]=!1)))}}},run(e,s){const t=this.moveX,i=this.moveY,a=this.posX,o=this.posY;t[e]?a[e]>0?(this.posX[e]-=s,this.crash(e)):this.moveX[e]=!1:a[e]<this.clientWidth-this.diceSize?(this.posX[e]+=s,this.crash(e)):this.moveX[e]=!0,i[e]?o[e]>this.marginTop?(this.posY[e]-=s,this.crash(e)):this.moveY[e]=!1:o[e]<this.clientHeight-this.diceSize?(this.posY[e]+=s,this.crash(e)):this.moveY[e]=!0}},computed:{reduceVals(){return this.vals.reduce(((e,s)=>e+s))}},mounted(){this.init()},unmounted(){this.destroy()},onLoad(){c().getConfig().then((e=>{this.bannerAdpid=e.bannerAdpid||"",this.bannerUnitId=e.bannerUnitId||""}))},onShareAppMessage:()=>({title:"游趣街 - 摇骰子，6个6，开不开！快和小伙伴一起玩吧!",path:"/pages/rollDice/rollDice",imageUrl:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-9c9554a3-d4de-4f0f-b941-dfe1990da1c1/c7b538e6-431a-4faf-a0a4-a22ed087199c.png"}),onShareTimeline:()=>({title:"游趣街 - 摇骰子，6个6，开不开！快和小伙伴一起玩吧!",path:"/pages/rollDice/rollDice",imageUrl:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-9c9554a3-d4de-4f0f-b941-dfe1990da1c1/c7b538e6-431a-4faf-a0a4-a22ed087199c.png"})},[["render",function(e,s,t,i,a,o){const h=C,l=T(X("uni-icons"),I),c=p,j=_,V=T(X("uni-data-checkbox"),U),W=T(X("uni-forms-item"),S),A=x,R=y,H=T(X("uni-forms"),D),F=T(X("uni-popup"),z);return n(),d(c,{style:{position:"relative"}},{default:r((()=>[u(c,{class:"container",onClick:o.randomDiceThrow},{default:r((()=>[u(c,{class:"top-wrap"},{default:r((()=>[(n(!0),m(v,null,f(a.vals,((e,s)=>(n(),d(h,{class:"tag",key:"tag"+s},{default:r((()=>[b(w(a.showRes?e:"?"),1)])),_:2},1024)))),128)),u(l,{class:"setting",type:"gear-filled",size:"30",onClick:g(o.setting,["stop"])},null,8,["onClick"])])),_:1}),u(h,{class:"reduce-text"},{default:r((()=>[b(w(a.showRes?o.reduceVals:"?"),1)])),_:1}),u(h,{class:"tip-text"},{default:r((()=>[b("摇一摇或点击屏幕")])),_:1}),(n(!0),m(v,null,f(a.vals,((e,s)=>(n(),d(c,{id:"dice"+s,class:"dice-wrap",key:"dice"+s,style:M({left:a.posX[s]+"px",top:a.posY[s]+"px"})},{default:r((()=>[u(c,{class:k(["dice",[a.diceColor,{throw:a.isthrow,rolling:a.isrolling}]]),style:M({transform:`rotate3d(${a.perFace[e-1]}, 180deg)`})},{default:r((()=>[u(c,{class:"dice-face front"}),u(c,{class:"dice-face up"}),u(c,{class:"dice-face left"}),u(c,{class:"dice-face right"}),u(c,{class:"dice-face bottom"}),u(c,{class:"dice-face back"})])),_:2},1032,["class","style"])])),_:2},1032,["id","style"])))),128))])),_:1},8,["onClick"]),u(F,{ref:"popup","background-color":"#fff",animation:!0},{default:r((()=>[u(c,{class:"popup-content"},{default:r((()=>[a.bannerAdpid||a.bannerUnitId?(n(),d(c,{key:0,style:{width:"100%",display:"flex","justify-content":"center","margin-bottom":"20px"}},{default:r((()=>[a.bannerAdpid&&!a.bannerUnitId?(n(),d(j,{key:0,adpid:a.bannerAdpid},null,8,["adpid"])):Y("",!0),a.bannerUnitId?(n(),d(j,{key:1,unitId:a.bannerUnitId},null,8,["unitId"])):Y("",!0)])),_:1})):Y("",!0),u(H,{ref:"baseForm"},{default:r((()=>[u(W,{label:"颜色"},{default:r((()=>[u(V,{modelValue:a.diceColor,"onUpdate:modelValue":s[0]||(s[0]=e=>a.diceColor=e),localdata:a.colors,selectedColor:"#51aa38",onChange:o.diceColorChange},null,8,["modelValue","localdata","onChange"])])),_:1}),u(W,{label:"个数"},{default:r((()=>[u(A,{value:a.vals.length,min:"1",max:"10","show-value":"",onChange:o.diceNumChange},null,8,["value","onChange"])])),_:1}),u(W,{label:"静音"},{default:r((()=>[u(R,{checked:a.isMute,onChange:o.diceMuteChange,style:{transform:"scale(0.7)"}},null,8,["checked","onChange"])])),_:1})])),_:1},512)])),_:1})])),_:1},512)])),_:1})}],["__scopeId","data-v-9bdc5ae0"]]);export{V as default};
