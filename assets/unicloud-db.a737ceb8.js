import{o as t,a as e,w as i,h as s,n as a,e as o,f as n,t as l,b as r,i as c,g as d,m as u,a4 as h,a5 as p,a6 as g,r as m,d as f,y,W as b,j as _,a7 as w,E as S,L as C,k as x,l as k,G as v,a8 as T}from"./index-ab7ec73d.js";import{_ as I}from"./uni-icons.63e5f710.js";import{r as B,s as D,a as L}from"./uni-app.es.f46513ae.js";import{_ as $}from"./_plugin-vue_export-helper.1b428a4d.js";const M=$({name:"UniBadge",emits:["click"],props:{type:{type:String,default:"error"},inverted:{type:Boolean,default:!1},isDot:{type:Boolean,default:!1},maxNum:{type:Number,default:99},absolute:{type:String,default:""},offset:{type:Array,default:()=>[0,0]},text:{type:[String,Number],default:""},size:{type:String,default:"small"},customStyle:{type:Object,default:()=>({})}},data:()=>({}),computed:{width(){return 8*String(this.text).length+12},classNames(){const{inverted:t,type:e,size:i,absolute:s}=this;return[t?"uni-badge--"+e+"-inverted":"","uni-badge--"+e,"uni-badge--"+i,s?"uni-badge--absolute":""].join(" ")},positionStyle(){if(!this.absolute)return{};let t=this.width/2,e=10;this.isDot&&(t=5,e=5);const i=`${-t+this.offset[0]}px`,s=`${-e+this.offset[1]}px`,a={rightTop:{right:i,top:s},rightBottom:{right:i,bottom:s},leftBottom:{left:i,bottom:s},leftTop:{left:i,top:s}},o=a[this.absolute];return o||a.rightTop},badgeWidth(){return{width:`${this.width}px`}},dotStyle(){return this.isDot?{width:"10px",height:"10px",borderRadius:"10px"}:{}},displayValue(){const{isDot:t,text:e,maxNum:i}=this;return t?"":Number(e)>i?`${i}+`:e}},methods:{onClick(){this.$emit("click")}}},[["render",function(u,h,p,g,m,f){const y=c,b=d;return t(),e(b,{class:"uni-badge--x"},{default:i((()=>[s(u.$slots,"default",{},void 0,!0),p.text?(t(),e(y,{key:0,class:a([f.classNames,"uni-badge"]),style:o([f.badgeWidth,f.positionStyle,p.customStyle,f.dotStyle]),onClick:h[0]||(h[0]=t=>f.onClick())},{default:i((()=>[n(l(f.displayValue),1)])),_:1},8,["class","style"])):r("",!0)])),_:3})}],["__scopeId","data-v-1fab354a"]]);const z=$({name:"UniListItem",emits:["click","switchChange"],props:{direction:{type:String,default:"row"},title:{type:String,default:""},note:{type:String,default:""},ellipsis:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},clickable:{type:Boolean,default:!1},showArrow:{type:[Boolean,String],default:!1},link:{type:[Boolean,String],default:!1},to:{type:String,default:""},showBadge:{type:[Boolean,String],default:!1},showSwitch:{type:[Boolean,String],default:!1},switchChecked:{type:[Boolean,String],default:!1},badgeText:{type:String,default:""},badgeType:{type:String,default:"success"},badgeStyle:{type:Object,default:()=>({})},rightText:{type:String,default:""},thumb:{type:String,default:""},thumbSize:{type:String,default:"base"},showExtraIcon:{type:[Boolean,String],default:!1},extraIcon:{type:Object,default:()=>({type:"",color:"#000000",size:20})},border:{type:Boolean,default:!0}},data:()=>({isFirstChild:!1}),mounted(){this.list=this.getForm(),this.list&&(this.list.firstChildAppend||(this.list.firstChildAppend=!0,this.isFirstChild=!0))},methods:{getForm(t="uniList"){let e=this.$parent,i=e.$options.name;for(;i!==t;){if(e=e.$parent,!e)return!1;i=e.$options.name}return e},onClick(){""===this.to?(this.clickable||this.link)&&this.$emit("click",{data:{}}):this.openPage()},onSwitchChange(t){this.$emit("switchChange",t.detail)},openPage(){-1!==["navigateTo","redirectTo","reLaunch","switchTab"].indexOf(this.link)?this.pageApi(this.link):this.pageApi("navigateTo")},pageApi(t){let e={url:this.to,success:t=>{this.$emit("click",{data:t})},fail:t=>{this.$emit("click",{data:t})}};switch(t){case"navigateTo":default:u(e);break;case"redirectTo":g(e);break;case"reLaunch":p(e);break;case"switchTab":h(e)}}}},[["render",function(o,u,h,p,g,_){const w=d,S=y,C=B(m("uni-icons"),I),x=c,k=B(m("uni-badge"),M),v=b;return t(),e(w,{class:a([{"uni-list-item--disabled":h.disabled},"uni-list-item"]),"hover-class":!h.clickable&&!h.link||h.disabled||h.showSwitch?"":"uni-list-item--hover",onClick:_.onClick},{default:i((()=>[g.isFirstChild?r("",!0):(t(),e(w,{key:0,class:a(["border--left",{"uni-list--border":h.border}])},null,8,["class"])),f(w,{class:a(["uni-list-item__container",{"container--right":h.showArrow||h.link,"flex--direction":"column"===h.direction}])},{default:i((()=>[s(o.$slots,"header",{},(()=>[f(w,{class:"uni-list-item__header"},{default:i((()=>[h.thumb?(t(),e(w,{key:0,class:"uni-list-item__icon"},{default:i((()=>[f(S,{src:h.thumb,class:a(["uni-list-item__icon-img",["uni-list--"+h.thumbSize]])},null,8,["src","class"])])),_:1})):h.showExtraIcon?(t(),e(w,{key:1,class:"uni-list-item__icon"},{default:i((()=>[f(C,{color:h.extraIcon.color,size:h.extraIcon.size,type:h.extraIcon.type},null,8,["color","size","type"])])),_:1})):r("",!0)])),_:1})]),!0),s(o.$slots,"body",{},(()=>[f(w,{class:a(["uni-list-item__content",{"uni-list-item__content--center":h.thumb||h.showExtraIcon||h.showBadge||h.showSwitch}])},{default:i((()=>[h.title?(t(),e(x,{key:0,class:a(["uni-list-item__content-title",[0!==h.ellipsis&&h.ellipsis<=2?"uni-ellipsis-"+h.ellipsis:""]])},{default:i((()=>[n(l(h.title),1)])),_:1},8,["class"])):r("",!0),h.note?(t(),e(x,{key:1,class:a(["uni-list-item__content-note",[0!==h.ellipsis&&h.ellipsis<=2?"uni-ellipsis-"+h.ellipsis:""]])},{default:i((()=>[n(l(h.note),1)])),_:1},8,["class"])):r("",!0)])),_:1},8,["class"])]),!0),s(o.$slots,"footer",{},(()=>[h.rightText||h.showBadge||h.showSwitch?(t(),e(w,{key:0,class:a(["uni-list-item__extra",{"flex--justify":"column"===h.direction}])},{default:i((()=>[h.rightText?(t(),e(x,{key:0,class:"uni-list-item__extra-text"},{default:i((()=>[n(l(h.rightText),1)])),_:1})):r("",!0),h.showBadge?(t(),e(k,{key:1,type:h.badgeType,text:h.badgeText,"custom-style":h.badgeStyle},null,8,["type","text","custom-style"])):r("",!0),h.showSwitch?(t(),e(v,{key:2,disabled:h.disabled,checked:h.switchChecked,onChange:_.onSwitchChange},null,8,["disabled","checked","onChange"])):r("",!0)])),_:1},8,["class"])):r("",!0)]),!0)])),_:3},8,["class"]),h.showArrow||h.link?(t(),e(C,{key:1,size:16,class:"uni-icon-wrapper",color:"#bbb",type:"arrowright"})):r("",!0)])),_:3},8,["class","hover-class","onClick"])}],["__scopeId","data-v-658d1640"]]);const E=$({name:"uniList","mp-weixin":{options:{multipleSlots:!1}},props:{enableBackToTop:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},border:{type:Boolean,default:!0}},created(){this.firstChildAppend=!1},methods:{loadMore(t){this.$emit("scrolltolower")}}},[["render",function(a,o,n,l,c,u){const h=d;return t(),e(h,{class:"uni-list uni-border-top-bottom"},{default:i((()=>[n.border?(t(),e(h,{key:0,class:"uni-list--border-top"})):r("",!0),s(a.$slots,"default",{},void 0,!0),n.border?(t(),e(h,{key:1,class:"uni-list--border-bottom"})):r("",!0)])),_:3})}],["__scopeId","data-v-a351b006"]]),j={en:{"uniCloud.component.add.success":"Success","uniCloud.component.update.success":"Success","uniCloud.component.remove.showModal.title":"Tips","uniCloud.component.remove.showModal.content":"是否删除该数据"},es:{"uniCloud.component.add.success":"新增成功","uniCloud.component.update.success":"修改成功","uniCloud.component.remove.showModal.title":"提示","uniCloud.component.remove.showModal.content":"是否删除该数据"},fr:{"uniCloud.component.add.success":"新增成功","uniCloud.component.update.success":"修改成功","uniCloud.component.remove.showModal.title":"提示","uniCloud.component.remove.showModal.content":"是否删除该数据"},"zh-Hans":{"uniCloud.component.add.success":"新增成功","uniCloud.component.update.success":"修改成功","uniCloud.component.remove.showModal.title":"提示","uniCloud.component.remove.showModal.content":"是否删除该数据"},"zh-Hant":{"uniCloud.component.add.success":"新增成功","uniCloud.component.update.success":"修改成功","uniCloud.component.remove.showModal.title":"提示","uniCloud.component.remove.showModal.content":"是否刪除數據"}},A=Array.isArray,{t:F}=_(j),N="load",O="error",K="add",P="replace",R="auto",W="manual",J=["pageCurrent","pageSize","collection","action","field","getcount","orderby","where","groupby","groupField","distinct"];const V=$({name:"UniClouddb",setup(t){const e=t.ssrKey?t.getone?D(void 0,t.ssrKey):L([],t.ssrKey):t.getone?D(void 0,"SNC0FF6AnOrJdtlrVS1w1g=="):L([],"yxuWH3IPe0ZDuJvZ41qVcw=="),i=T();return w((()=>{e.value&&0!==e.value.length||t.manual||t.loadtime!==R||i.proxy.loadData()})),{dataList:e}},async serverPrefetch(){if(!this.manual&&this.loadtime===R)return this.loadData()},props:{options:{type:[Object,Array],default:()=>({})},spaceInfo:{type:Object,default:()=>({})},collection:{type:[String,Array],default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},getone:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String,Object],default:!1},gettreepath:{type:[Boolean,String],default:!1},startwith:{type:String,default:""},limitlevel:{type:Number,default:10},groupby:{type:String,default:""},groupField:{type:String,default:""},distinct:{type:[Boolean,String],default:!1},pageIndistinct:{type:[Boolean,String],default:!1},foreignKey:{type:String,default:""},loadtime:{type:String,default:"auto"},manual:{type:Boolean,default:!1},ssrKey:{type:[String,Number],default:""}},data:()=>({loading:!1,hasMore:!1,paginationInternal:{},errorMessage:""}),computed:{collectionArgs(){return A(this.collection)?this.collection:[this.collection]},isLookup(){return A(this.collection)&&this.collection.length>1||"string"==typeof this.collection&&this.collection.indexOf(",")>-1},mainCollection(){if("string"==typeof this.collection)return this.collection.split(",")[0];return JSON.parse(JSON.stringify(this.collection[0])).$db[0].$param[0]}},created(){this._isEnded=!1,this.paginationInternal={current:this.pageCurrent,size:this.pageSize,count:0},this.$watch((()=>{var t=[];return J.forEach((e=>{t.push(this[e])})),t}),((t,e)=>{if(this.paginationInternal.size=this.pageSize,t[0]!==e[0]&&(this.paginationInternal.current=this.pageCurrent),this.loadtime===W)return;let i=!1;for(let s=2;s<t.length;s++)if(t[s]!==e[s]){i=!0;break}i&&(this.clear(),this.reset()),this._execLoadData()}))},methods:{loadData(t,e){let i=null,s=!1;return"object"==typeof t?(t.clear&&(this.pageData===P?this.clear():s=t.clear,this.reset()),void 0!==t.current&&(this.paginationInternal.current=t.current),"function"==typeof e&&(i=e)):"function"==typeof t&&(i=t),this._execLoadData(i,s)},loadMore(){this._isEnded||this.loading||(this.pageData===K&&this.paginationInternal.current++,this._execLoadData())},refresh(){this.clear(),this._execLoadData()},clear(){this._isEnded=!1,this.dataList=[]},reset(){this.paginationInternal.current=1},add(t,{action:e,showToast:i=!0,toastTitle:s,success:a,fail:o,complete:n,needConfirm:l=!0,needLoading:r=!0,loadingTitle:c=""}={}){r&&S({title:c});let d=C.database(this.spaceInfo);e&&(d=d.action(e)),d.collection(this.mainCollection).add(t).then((t=>{a&&a(t),i&&x({title:s||F("uniCloud.component.add.success")})})).catch((t=>{o&&o(t),l&&k({content:t.message,showCancel:!1})})).finally((()=>{r&&v(),n&&n()}))},remove(t,{action:e,success:i,fail:s,complete:a,confirmTitle:o,confirmContent:n,needConfirm:l=!0,needLoading:r=!0,loadingTitle:c=""}={}){t&&t.length&&(l?k({title:o||F("uniCloud.component.remove.showModal.title"),content:n||F("uniCloud.component.remove.showModal.content"),showCancel:!0,success:o=>{o.confirm&&this._execRemove(t,e,i,s,a,l,r,c)}}):this._execRemove(t,e,i,s,a,l,r,c))},update(t,e,{action:i,showToast:s=!0,toastTitle:a,success:o,fail:n,complete:l,needConfirm:r=!0,needLoading:c=!0,loadingTitle:d=""}={}){c&&S({title:d});let u=C.database(this.spaceInfo);return i&&(u=u.action(i)),u.collection(this.mainCollection).doc(t).update(e).then((t=>{o&&o(t),s&&x({title:a||F("uniCloud.component.update.success")})})).catch((t=>{n&&n(t),r&&k({content:t.message,showCancel:!1})})).finally((()=>{c&&v(),l&&l()}))},getTemp(t=!0){let e=C.database(this.spaceInfo);this.action&&(e=e.action(this.action)),e=e.collection(...this.collectionArgs),this.foreignKey&&(e=e.foreignKey(this.foreignKey)),this.where&&Object.keys(this.where).length&&(e=e.where(this.where)),this.field&&(e=e.field(this.field)),this.groupby&&(e=e.groupBy(this.groupby)),this.groupField&&(e=e.groupField(this.groupField)),!0===this.distinct&&(e=e.distinct()),this.orderby&&(e=e.orderBy(this.orderby));const{current:i,size:s}=this.paginationInternal,a={};this.getcount&&(a.getCount=this.getcount);const o={limitLevel:this.limitlevel,startWith:this.startwith};return this.gettree&&(a.getTree=o),this.gettreepath&&(a.getTreePath=o),e=e.skip(s*(i-1)).limit(s),t?(e=e.getTemp(a),e.udb=this):e=e.get(a),e},setResult(t){0===t.code?this._execLoadDataSuccess(t):this._execLoadDataFail(new Error(t.message))},_execLoadData(t,e){if(!this.loading)return this.loading=!0,this.errorMessage="",this._getExec().then((i=>{this.loading=!1,this._execLoadDataSuccess(i.result,t,e)})).catch((e=>{this.loading=!1,this._execLoadDataFail(e,t)}))},_execLoadDataSuccess(t,e,i){const{data:s,count:a}=t;this._isEnded=void 0!==a?this.paginationInternal.current*this.paginationInternal.size>=a:s.length<this.pageSize,this.hasMore=!this._isEnded;const o=this.getone?s.length?s[0]:void 0:s;this.getcount&&(this.paginationInternal.count=a),e&&e(o,this._isEnded,this.paginationInternal),this._dispatchEvent(N,o),this.getone||this.pageData===P||i?this.dataList=o:this.dataList.push(...o)},_execLoadDataFail(t,e){this.errorMessage=t,e&&e(),this.$emit(O,t)},_getExec(){return this.getTemp(!1)},_execRemove(t,e,i,s,a,o,n,l){if(!this.collection||!t)return;const r=A(t)?t:[t];if(!r.length)return;n&&S({mask:!0,title:l});const c=C.database(this.spaceInfo),d=c.command;let u=c;e&&(u=u.action(e)),u.collection(this.mainCollection).where({_id:d.in(r)}).remove().then((t=>{i&&i(t.result),this.pageData===P?this.refresh():this.removeData(r)})).catch((t=>{s&&s(t),o&&k({content:t.message,showCancel:!1})})).finally((()=>{n&&v(),a&&a()}))},removeData(t){const e=t.slice(0),i=this.dataList;for(let s=i.length-1;s>=0;s--){const t=e.indexOf(i[s]._id);t>=0&&(i.splice(s,1),e.splice(t,1))}},_dispatchEvent(t,e){this._changeDataFunction?this._changeDataFunction(e,this._isEnded,this.paginationInternal):this.$emit(t,e,this._isEnded,this.paginationInternal)}}},[["render",function(a,o,n,l,r,c){const u=d;return t(),e(u,null,{default:i((()=>[s(a.$slots,"default",{options:n.options,data:l.dataList,pagination:r.paginationInternal,loading:r.loading,hasMore:r.hasMore,error:r.errorMessage})])),_:3})}]]);export{z as _,E as a,V as b};
