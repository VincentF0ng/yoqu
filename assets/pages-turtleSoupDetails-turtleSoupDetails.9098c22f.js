import{o as t,a as e,w as a,h as i,g as s,v as d,_ as l,j as r,V as o,W as n,Y as h,k as c,X as u,m as p,p as _,d as f,f as g,t as y,J as w,K as b,Z as A,b as k,F as m,r as C,i as V,u as L}from"./index.d9f4ebbb.js";import{_ as E}from"./uni-tag.cea29736.js";import{_ as x,r as v}from"./uni-app.es.5b214af4.js";import{_ as I}from"./uni-icons.be7bee54.js";import{_ as W}from"./uni-card.763de631.js";import{_ as S}from"./v-btn.a4477718.js";const U="RewardedVideo",j="FullScreenVideo",D="Interstitial",O="load",P="close",R="error",T="csj";class z{constructor(t,e={}){this._isLoad=!1,this._isLoading=!1,this._isPlaying=!1,this._lastLoadTime=0,this._lastError=null,this._retryCount=0,void 0!==e.retry?this._retry=e.retry:this._retry=!0,this._loadCallback=null,this._closeCallback=null,this._errorCallback=null;const a=this._ad=t;a.onLoad((t=>{this._isLoading=!1,this._isLoad=!0,this._lastLoadTime=Date.now(),this.onLoad()})),a.onClose((t=>{this._isLoad=!1,this._isPlaying=!1,this.onClose(t)})),a.onVerify&&a.onVerify((t=>{})),a.onError((({code:t,message:e})=>{this._isLoading=!1;const a={code:t,errMsg:e};if(this._retry&&-5008===t)this._loadAd();else{if(this._retry&&this._retryCount<1)return this._retryCount+=1,void this._loadAd();this._lastError=a,this.onError(a)}}))}get isExpired(){return 0!==this._lastLoadTime&&Math.abs(Date.now()-this._lastLoadTime)>18e5}get isLoad(){return this._isLoad}get isLoading(){return this._isLoading}getProvider(){return this._ad.getProvider()}load(t,e){this._loadCallback=t,this._errorCallback=e,this._isPlaying?e&&e():this._isLoading||(this._isLoad?this.onLoad():(this._retryCount=0,this._loadAd()))}show(t,e){if(this._closeCallback=t,this._isLoading||this._isPlaying||!this._isLoad)return;if(null!==this._lastError)return void this.onError(this._lastError);this.getProvider()===T&&this.isExpired?this._retry?this._loadAd():this.onError(this._lastError):(this._isPlaying=!0,this._ad.show(),e&&e())}onLoad(t){null!=this._loadCallback&&this._loadCallback()}onClose(t){null!=this._closeCallback&&this._closeCallback({isEnded:t.isEnded})}onError(t){null!=this._errorCallback&&this._errorCallback(t)}destroy(){this._ad.destroy()}_loadAd(){this._isLoad=!1,this._isLoading=!0,this._lastError=null,this._ad.load()}}class G extends z{constructor(t={}){super(plus.ad.createRewardedVideoAd(t),t)}}class B extends z{constructor(t={}){super(plus.ad.createFullScreenVideoAd(t),t)}}class F extends z{constructor(t={}){super(plus.ad.createInterstitialAd(t),t)}}class M{constructor(t){this._ads={},this._adType=t,this._lastWaterfallIndex=-1}load(t,e,a){t.adpid&&!this.isBusy(t.adpid)&&this.get(t).load(e,a)}show(t,e,a,i,s){const d=this.get(t);d.isLoad?(this._lastWaterfallIndex=-1,d.show((t=>{i&&i(t)}),(()=>{s&&s()}))):d.load((()=>{this._lastWaterfallIndex=-1,e&&e(),d.show((t=>{i&&i(t)}),(()=>{s&&s()}))}),(t=>{a&&a(t)}))}loadWaterfall(t,e,a,i=0){const{adpid:s,urlCallback:d}=t;if(!Array.isArray(s))return;const l={adpid:s[i],urlCallback:d,retry:!1};console.log("ad.loadWaterfall::index="+i),this.load(l,(t=>{this._lastWaterfallIndex=i,e(l)}),(d=>{++i>=s.length?a(d):this.loadWaterfall(t,e,a,i)}))}showWaterfall(t,e,a,i,s,d=0){const{adpid:l,urlCallback:r}=t;if(!Array.isArray(l))return;this._lastWaterfallIndex>-1&&(d=this._lastWaterfallIndex);const o={adpid:l[d],urlCallback:r,retry:!1};console.log("ad.showWaterfall::index="+d),this.show(o,(()=>{e()}),(r=>{++d>=l.length?a(r):this.showWaterfall(t,e,a,i,s,d)}),(t=>{i(t)}),(()=>{s()}))}preloadWaterfall(t,e=0,a=1){if(1===a)return void this.loadWaterfall(t,(t=>{console.log("preloadWaterfall.success::",t)}),(t=>{console.log("loadWaterfall.fail",t)}));const{adpid:i,urlCallback:s}=t;for(let d=0;d<a&&e<i.length;d++){const d={adpid:i[e],urlCallback:s};this.loadWaterfall(d,(t=>{console.log("preloadWaterfall.success::",t)}),(i=>{console.log("loadWaterfall.fail",i),this.preloadWaterfall(t,e,a)})),e++}}isBusy(t){return this._ads[t]&&this._ads[t].isLoading}get(t){const{adpid:e}=t;return this._ads[e]||(this._ads[e]=this._createInstance(t)),this._ads[e]}getProvider(t){return this._ads[t]?this._ads[t].getProvider():null}remove(t){this._ads[t]&&(this._ads[t].destroy(),delete this._ads[t])}_createInstance(t){const e=t.adType||this._adType;delete t.adType;let a=null;return e===U?a=new G(t):e===j?a=new B(t):e===D&&(a=new F(t,!0)),a}}const H=x({name:"AdRewardedVideo",mixins:[{props:{options:{type:[Object,Array],default:()=>({})},disabled:{type:[Boolean,String],default:!1},adpid:{type:[Number,String,Array],default:""},preload:{type:[Boolean,String],default:!0},loadnext:{type:[Boolean,String],default:!1},urlCallback:{type:Object,default:()=>({})}},data:()=>({loading:!1,errorMessage:null}),created(){this.$watch("adpid",((t,e)=>{this._removeInstance(e),this.preload&&this._loadAd()})),this.$watch("urlCallback",(()=>{this._removeInstance()})),this._adHelper=new M(this.adType),setTimeout((()=>{this.preload&&this._loadAd()}),100)},methods:{load(){if(this.isLoading)return;this._startLoading();const t=this._isWaterfall()?"loadWaterfall":"load";this._adHelper[t](this._getAdOptions(),(()=>{this._onLoad()}),(t=>{this._onLoadFail(t)}))},show(){if(this.isLoading)return;this._startLoading();const t=this._isWaterfall()?"showWaterfall":"show";this._adHelper[t](this._getAdOptions(),(()=>{this._onLoad()}),(t=>{this._onLoadFail(t)}),(t=>{this._dispatchEvent(P,t),this.loadnext&&this.load()}),(()=>{this.loading=!1}))},getProvider(){return Array.isArray(this.adpid)?null:this._adHelper.getProvider(this.adpid)},_loadAd(){this._canCreateAd()&&this.load()},_onclick(){this.disabled||this.show()},_getAdOptions(){return{adpid:this.adpid,urlCallback:this.urlCallback}},_isWaterfall(){return Array.isArray(this.adpid)&&this.adpid.length>0},_canCreateAd(){let t=!1;return(Array.isArray(this.adpid)&&this.adpid.length>0||"string"==typeof this.adpid&&this.adpid.length>0||"number"==typeof this.adpid)&&(t=!0),t},_removeInstance(t){const e=t||this.adpid;Array.isArray(e)?e.forEach((t=>{this._adHelper.remove(t)})):e&&this._adHelper.remove(e)},_startLoading(){this.loading=!0,this.errorMessage=null},_onLoad(){this.loading=!1,this._dispatchEvent(O,{})},_onLoadFail(t){this.loading=!1,this.errorMessage=JSON.stringify(t),this._dispatchEvent(R,t)},_dispatchEvent(t,e){this.$emit(t,{detail:e})}}}],props:{adType:{type:String,default:"RewardedVideo"}}},[["render",function(d,l,r,o,n,h){const c=s;return t(),e(c,{onClick:d._onclick},{default:a((()=>[i(d.$slots,"default",{options:d.options,loading:d.loading,error:d.errorMessage})])),_:3},8,["onClick"])}]]);const $=x({data:()=>({bannerAdpid:"",bannerUnitId:"",rewardVideoAdpid:"",rewardVideoUnitId:"",unlockVideoAd:!1,details:{},showAnswer:!1,check:!1}),methods:{handleCopyQuestion(){d(),l({data:this.details.question,success:()=>{r({title:"复制成功",icon:"none"})}})},handleGetRandom(){d(),o({title:"加载中"});n.importObject("tutleSoupsOptions").getRandomOne().then((t=>{if(t._id===this.details._id)return this.handleGetRandom();this.showAnswer=!1,this.details=t})).finally((t=>{h()}))},handleContributeSuggest(t=1){c({url:"/pages/contributeSuggest/contributeSuggest?type="+t})},handleBoardGame(){c({url:"/pages/boardGameDetails/boardGameDetails?id=62fb6f6f3e021975b48126f3"})},handleECoupon(){c({url:"/pages/eCoupon/eCoupon"})},showAnswerClick(){if(d(),!this.rewardVideoAdpid&&!this.rewardVideoUnitId||this.unlockVideoAd)return this.showAnswer=!this.showAnswer;u({title:"提示",content:"观看一次视频解锁所有汤底？",success:t=>{t.confirm&&(this.rewardVideoUnitId?this._rewardedVideoAd.show().catch((()=>{this._rewardedVideoAd.load().then((()=>rewardedVideoAd.show())).catch((t=>{this.rewardAdError()}))})):this.$refs.adRewardedVideo.show())}})},rewardAdClose(t){const e=t.detail;if(e&&e.isEnded||t.isEnded){p().globalData.unlockVideoAd=!0,this.showAnswer=!0,this.unlockVideoAd=!0}},rewardAdError(){p().globalData.unlockVideoAd=!0,this.showAnswer=!0,this.unlockVideoAd=!0,r({title:"加载视频失败，直接解锁！",icon:"none",duration:4e3})},initVideoAd(){let t=null;if(this.rewardVideoUnitId)t=this._rewardedVideoAd=uni.createRewardedVideoAd({adUnitId:this.rewardVideoUnitId});else{if(!this.rewardVideoAdpid)return;t=this._rewardedVideoAd=uni.createRewardedVideoAd({adpid:this.rewardVideoAdpid})}t.onError((t=>{console.log("onError event emit",t)})),t.onClose(this.rewardAdClose)}},onLoad:function(t){if(!t.id)return c({url:"/pages/turtleSoup/turtleSoup"});const e=p();this.unlockVideoAd=e.globalData.unlockVideoAd||!1,e.getConfig().then((t=>{this.bannerAdpid=t.bannerAdpid||"",this.bannerUnitId=t.bannerUnitId||"",this.rewardVideoAdpid=t.rewardVideoAdpid||"",this.rewardVideoUnitId=t.rewardVideoUnitId||"",this.check=t.check||!1})),o({title:"加载中"});n.importObject("tutleSoupsOptions").getDetails(t.id).then((t=>{this.details=t})).finally((t=>{h(),this.initVideoAd()}))},onShareAppMessage(){return{title:"汤面："+this.details.question,path:"/pages/turtleSoupDetails/turtleSoupDetails?id="+this.details._id,imageUrl:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-9c9554a3-d4de-4f0f-b941-dfe1990da1c1/67ffde71-5506-47e8-b8e1-a900aae92998.png"}},onShareTimeline(){return{title:"汤面："+this.details.question,path:"/pages/turtleSoupDetails/turtleSoupDetails?id="+this.details._id,imageUrl:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-9c9554a3-d4de-4f0f-b941-dfe1990da1c1/67ffde71-5506-47e8-b8e1-a900aae92998.png"}}},[["render",function(i,d,l,r,o,n){const h=v(C("uni-tag"),E),c=s,u=V,p=L,x=v(C("uni-icons"),I),U=v(C("uni-card"),W),j=v(C("v-btn"),S),D=v(C("ad-rewarded-video"),H);return t(),e(c,{class:"container"},{default:a((()=>["{}"!==JSON.stringify(o.details)?(t(),_(m,{key:0},[f(U,{title:o.details.title,extra:"作者："+o.details.authour+(o.details.contribute?"【网友投稿】":"")},{actions:a((()=>[f(c,{class:"card-actions"},{default:a((()=>[f(c,{onClick:n.handleCopyQuestion,class:"actions-item"},{default:a((()=>[f(x,{style:{"margin-right":"5px"},type:"chat",size:"18",color:"#999"}),f(u,null,{default:a((()=>[g("复制汤面")])),_:1})])),_:1},8,["onClick"]),f(c,{onClick:n.showAnswerClick,class:"actions-item"},{default:a((()=>[f(x,{style:{"margin-right":"5px"},type:o.showAnswer?"eye-slash":"eye",size:"18",color:"#999"},null,8,["type"]),f(u,null,{default:a((()=>[g(y(o.showAnswer?"隐藏":"显示")+"汤底",1)])),_:1})])),_:1},8,["onClick"]),f(c,{onClick:n.handleGetRandom,class:"actions-item"},{default:a((()=>[f(x,{style:{"margin-right":"5px"},type:"loop",size:"18",color:"#999"}),f(u,null,{default:a((()=>[g("随机出题")])),_:1})])),_:1},8,["onClick"])])),_:1})])),default:a((()=>[f(c,{class:"tag-wrap"},{default:a((()=>[w(f(h,{size:"mini",text:"经典",type:"warning",inverted:"",circle:""},null,512),[[b,1===o.details.classic]]),w(f(h,{size:"mini",text:"精选",type:"error",inverted:"",circle:""},null,512),[[b,1===o.details.chosen]])])),_:1}),A("p",{class:"title"},"汤面"),f(u,{class:"content"},{default:a((()=>[g(y(o.details.question),1)])),_:1}),o.showAnswer?(t(),_("p",{key:0,class:"title"},"汤底")):k("",!0),o.showAnswer?(t(),e(u,{key:1,class:"content"},{default:a((()=>[g(y(o.details.answer),1)])),_:1})):k("",!0),o.details.contribute&&0===o.details.share?(t(),e(c,{key:2,class:"msg"},{default:a((()=>[f(c,null,{default:a((()=>[g("该汤来自网友投稿")])),_:1}),f(c,null,{default:a((()=>[g("请勿随意转发其他平台")])),_:1}),f(c,null,{default:a((()=>[g("可联系作者【"+y(o.details.authour)+"】",1)])),_:1}),o.details.contact?(t(),e(c,{key:0},{default:a((()=>[g("联系方式【"+y(o.details.contact)+"】",1)])),_:1})):k("",!0)])),_:1})):(t(),e(c,{key:3,class:"msg"},{default:a((()=>[f(c,null,{default:a((()=>[g("本文来源于网络，版权属于原作者。")])),_:1}),f(c,null,{default:a((()=>[g("如有侵权，请右上角小程序介绍页，联系客服删除!")])),_:1})])),_:1})),o.bannerAdpid||o.bannerUnitId?(t(),e(c,{key:4,style:{"margin-bottom":"20px",display:"flex","justify-content":"center"}},{default:a((()=>[o.bannerAdpid&&!o.bannerUnitId?(t(),e(p,{key:0,adpid:o.bannerAdpid},null,8,["adpid"])):k("",!0),o.bannerUnitId?(t(),e(p,{key:1,unitId:o.bannerUnitId},null,8,["unitId"])):k("",!0)])),_:1})):k("",!0)])),_:1},8,["title","extra"]),f(c,{class:"option-wrap"},{default:a((()=>[f(j,{class:"btn",type:"primary","open-type":"share"},{default:a((()=>[f(u,{style:{"margin-right":"10px"}},{default:a((()=>[g("分享给朋友")])),_:1}),f(x,{type:"chatboxes-filled",size:"20",color:"#E4EBF5"})])),_:1}),o.check?k("",!0):(t(),e(j,{key:0,class:"btn",type:"plain",onClick:n.handleECoupon},{default:a((()=>[f(u,{style:{"margin-right":"10px"}},{default:a((()=>[g("领红包")])),_:1}),f(x,{type:"gift-filled",size:"20",color:"#6d5dfc"})])),_:1},8,["onClick"])),f(j,{class:"btn",type:"plain",onClick:n.handleBoardGame},{default:a((()=>[f(u,{style:{"margin-right":"10px"}},{default:a((()=>[g("查看规则")])),_:1}),f(x,{type:"redo-filled",size:"20",color:"#6d5dfc"})])),_:1},8,["onClick"]),o.check?k("",!0):(t(),e(j,{key:1,class:"btn",type:"plain",onClick:d[0]||(d[0]=t=>n.handleContributeSuggest(1))},{default:a((()=>[f(u,{style:{"margin-right":"10px"}},{default:a((()=>[g("我要投稿")])),_:1}),f(x,{type:"email-filled",size:"20",color:"#6d5dfc"})])),_:1}))])),_:1})],64)):k("",!0),f(D,{ref:"adRewardedVideo",adpid:o.rewardVideoAdpid,preload:!1,loadnext:!1,disabled:!0,onClose:n.rewardAdClose,onError:n.rewardAdError},{default:a((({loading:i,error:s})=>[s?(t(),e(c,{key:0,class:"ad-error"},{default:a((()=>[g(y(s),1)])),_:2},1024)):k("",!0)])),_:1},8,["adpid","onClose","onError"])])),_:1})}],["__scopeId","data-v-c74b6e83"]]);export{$ as default};
